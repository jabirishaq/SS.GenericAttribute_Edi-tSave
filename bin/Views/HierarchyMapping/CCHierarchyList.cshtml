@model SmartStore.Admin.Models.Hierarchy.GridModelCC<SmartStore.Admin.Models.Hierarchy.HierarchyMappingModel>
@using Telerik.Web.Mvc.UI;
@{
    Layout = "~/Administration/Views/Shared/Layouts/_AdminLayout.cshtml";
}
@{
    ViewBag.Title = T("CCHierarchy Detail").Text.ToUpper();
    var Parent = ViewData["parentHierarchyType"] != null ? ViewData["parentHierarchyType"].ToString() : "U";
    var child = ViewData["childHierarchyType"] != null ? ViewData["childHierarchyType"].ToString() : "U";
    var HierarchyType = ViewData["HierarchyType"].ToString();

    int entityId = ViewData["entityId"] != null ? Convert.ToInt16(ViewData["entityId"]) : 1;
    bool IsParent = false;
}

<div class="section-header">
    <div class="title">
        <i class="fa fa-users"></i>
        @{
            if (HierarchyType == "U2U")
            { @T("Admin.Configuration.Hierarchy.U2U");
        }
        else if (HierarchyType == "R2U")
        { @T("Admin.Configuration.Hierarchy.R2U");
    }
    else if (HierarchyType == "U2R")
    { @T("Admin.Configuration.Hierarchy.U2R");
}
else if (HierarchyType == "R2R")
{ @T("Admin.Configuration.Hierarchy.R2R");
}
<a href='@Url.Action("List","Hierarchy")'>(@T("Admin.Configuration.Hierarchy.CCHierarchyEntity.Entities.BackToList"))</a>
        }

        <input type="text" id="txtEntityId" value="@entityId" hidden="hidden" />
    </div>
</div>
<div class="row supreme-container">
    @{
        if (Parent == "U")
        {
            <div class="col-md-6">
                <div class="row">
                    <div class="col-md-9">
                        <h5>@T("Admin.Configuration.Hierarchy.ParentCustomers")</h5>
                    </div>
                    <button type="button" id="btnParentCustomers" value="AddNew" class="btn btn-primary mb-1 ml-5" data-toggle="modal" data-target="#Modal">
                        <i class="fa fa-check"></i>
                        <span>@T("Admin.Common.AddNew")</span>
                    </button>
                </div>

                <div id="divParentCustomerGrid">
                    @{ Html.RenderPartial("_ParentCustomerGrid", Model);}
                </div>
            </div>
        }
    }

    @{
        if (Parent == "R")
        {
            <div class="col-md-6">
                <div class="row">
                    <div class="col-md-9">
                        <h5>@*@T("Plugins.CC.Plugins.CCHierarchyMapping.ParentRoles")*@ Parent Roles</h5>
                    </div>
                    <button type="button" id="btnParentRoles" value="AddNew" class="btn btn-primary  mb-1 ml-5" data-toggle="modal" data-target="#Modal">
                        <i class="fa fa-check"></i>
                        <span>@T("Admin.Common.AddNew")</span>
                    </button>
                </div>

                <div id="divParentRolesGrid">
                    @{ Html.RenderPartial("_ParentRolesGrid", Model);}
                </div>
            </div>
        }
    }

    @{
        if (child == "U")
        {
            <div class="col-md-6">
                <div class="row">
                    <div class="col-md-9">
                        <h5>@T("Admin.Configuration.Hierarchy.ChildCustomers")</h5>
                    </div>
                    <button type="button" id="btnChildCustomers" value="AddNew" class="btn btn-primary  mb-1 ml-5" data-toggle="modal" data-target="#Modal">
                        <i class="fa fa-check"></i>
                        <span>@T("Admin.Common.AddNew")</span>
                    </button>
                </div>

                <div id="divChildCustomerGrid">
                    @{ Html.RenderPartial("_ChildCustomerGrid", Model);}
                </div>
            </div>
        }
    }

    @{
        if (child == "R")
        {
            <div class="col-md-6">
                <div class="row">
                    <div class="col-md-9">
                        <h5>@*@T("Plugins.CC.Plugins.CCHierarchyMapping.ChildRoles")*@ Child Roles</h5>
                    </div>
                    <button type="button" id="btnChildRoles" value="AddNew" class="btn btn-primary  mb-1 ml-5" data-toggle="modal" data-target="#Modal">
                        <i class="fa fa-check"></i>
                        <span>@T("Admin.Common.AddNew")</span>
                    </button>
                </div>
                <div id="divChildRolesGrid">
                    @{ Html.RenderPartial("_ChildRolesGrid", Model);}
                </div>
            </div>
        }
    }
</div>

@{Html.SmartStore().Window()
                  .Name("Modal")
                  .Size(WindowSize.Large)
                  .Content(
@<text>
    <div class="modal-body" id="divModalBody">
</text>)
.Render();
}
<script>

    var entityId = parseInt($("#txtEntityId").val());
    var IsParent = 1;
    var IsChild = 0;
    var ModelParent = { EntityId: entityId, IsParent: IsParent };
    var ModelChild = { EntityId: entityId, IsParent: IsChild };
    $("#btnParentCustomers").on('click', function () {
        $.ajax({
            type: 'GET',
            url: '@Url.Action("_AddCustomers", "HierarchyMapping")',
            contentType: "application/json; charset=utf-8",
            dataType: "JSON",
            //data: JSON.stringify(),
            data: ModelParent,
            success: function (result) {
                $('#divModalBody').html(result);
            }
        });
    });

    $("#btnChildCustomers").on('click', function () {
        $.ajax({
            type: 'GET',
            url: '@Url.Action("_AddCustomers", "HierarchyMapping")',
            contentType: "application/json; charset=utf-8",
            dataType: "JSON",
            //data: JSON.stringify(),
            data: ModelChild,
            success: function (result) {
                $('#divModalBody').html(result);
            }
        });
    });

    $("#btnParentRoles").on('click', function () {
        $.ajax({
            type: 'GET',
            url: '@Url.Action("_AddRoles", "HierarchyMapping")',
            contentType: "application/json; charset=utf-8",
            dataType: "JSON",
            //data: JSON.stringify(),
            data: ModelParent,
            success: function (result) {
                $('#divModalBody').html(result);
            }
        });
    });

    $("#btnChildRoles").on('click', function () {
        $.ajax({
            type: 'GET',
            url: '@Url.Action("_AddRoles", "HierarchyMapping")',
            contentType: "application/json; charset=utf-8",
            dataType: "JSON",
            //data: JSON.stringify(),
            data: ModelChild,
            success: function (result) {
                $('#divModalBody').html(result);
            }
        });
    });


    function CustomerSuccess(response)
    {
        $('#Modal').modal('hide');
        if (response.type == 1) {
            $("#divParentCustomerGrid").html(response.partialViewString);
        }
        else {
            $("#divChildCustomerGrid").html(response.partialViewString);
        }
    }

    function RoleSuccess(response) {
        $('#Modal').modal('hide');
        if (response.type == 1) {
            $("#divParentRolesGrid").html(response.partialViewString);
        }
        else {
            $("#divChildRolesGrid").html(response.partialViewString);
        }
	}

	function DeleteHierarchyMapping(entityId) {
		//alert(window.location.href.substring(window.location.href.lastIndexOf('=')+1));
		if (confirm("Are you really want to delete this record?"))
		{
			var ModelParent = { id: entityId };
			$.ajax({
                type: 'GET',
                url: '@Url.Action("Delete", "HierarchyMapping",new { id="_id"})'.replace('_id', entityId),
				contentType: "application/json; charset=utf-8",
				dataType: "JSON",
				//data: JSON.stringify(),
				//data: ModelParent,
				success: function (result) {
					if (result.RoleID == 0) {
						if (result.type == 1) {
							$("#divParentCustomerGrid").html(result.partialViewString);
						}
						else {
							$("#divChildCustomerGrid").html(result.partialViewString);
						}
					}
					else {
						if (result.type == 1) {
							$("#divParentRolesGrid").html(result.partialViewString);
						}
						else {
							$("#divChildRolesGrid").html(result.partialViewString);
						}
					}
				}
			});
		}
	}

</script>

