@model CheckoutBillingAddressModel
@using SmartStore.Web.Models.Checkout;

<div class="page billing-address-page">
    <div class="page-title">
        <h1 class="h3">@T("Checkout.BillingAddress")</h1>
    </div>
    <div class="page-body checkout-data">
        @{ Html.RenderWidget("checkout_billing_address_top"); }

        <fieldset class="content-group mb-3">

            <legend><span>@T("Checkout.SelectBillingAddress")</span></legend>
            <div class="card-deck card-cols-sm-12 card-cols-md-12 card-cols-lg-12 address-list">
                <div class="card card-block address-list-item" style="padding:20px">
                    <div class="address-item">
                        <div class="row">
                            <div class="col-md-12">
                                @Html.DropDownList("BillingAddress", new SelectList(Model.ExistingAddresses, "Id", "Address1", Model.SelectedAddress), new { @class = "form-control", id = "billingAddressDropDown" })
                                <div class="edit-billing-address-icon billing-address" data-id="1">
                                    <i class="fa fa-edit"></i>
                                </div>
                            </div>
                        </div>
                        <div class="enter-address-body billing-address d-none">
                            
                        </div>
                    </div>
                    </div>
                </div>
        </fieldset>
        

        @{ Html.RenderWidget("checkout_billing_address_middle"); }

        @{ Html.RenderWidget("checkout_billing_address_bottom"); }
    </div>
</div>
<script>
    $(function () {
        $('#billingAddressDropDown').on('change', function () {
            var id = $(this).val();
            if (id == 0) {
                $('.enter-address-body.billing-address').removeClass('d-none');
                $('.edit-billing-address-icon.billing-address').hide();
                $.ajax('@Url.Action("CreateOrEditAddress")', {
                    success: function (response) {
                        $('.enter-address-body.billing-address').html(response);
                    }
                });
            } else {
                prevBillAddSelected = id;
                $('.edit-billing-address-icon.billing-address').show();
                if (!$('.enter-address-body.billing-address').hasClass('d-none'))
                    $('.enter-address-body.billing-address').addClass('d-none');
            }
        });

		$('.edit-billing-address-icon.billing-address').on('click', editBilling);
        $('#billingAddressDropDown').select2().prepend('<option value="0">Add New</option>');
    });
</script>